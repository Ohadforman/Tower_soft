# pure helper logic (no streamlit)